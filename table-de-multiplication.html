<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>√âcole de Magie des Multiplications ‚ú®</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* Styles locaux suppl√©mentaires si besoin */
        .special-bg{background:linear-gradient(135deg,#2d1b4e 0%, #4a2c6b 50%, #6b4a8d 100%); color:#fff; padding:20px; border-radius:12px}
    </style>
</head>
<body>
    <div class="container special-bg">
        <a class="home-link" href="index.html">‚Üê Accueil</a>
        <h1>ü™Ñ √âcole de Magie des Multiplications üîÆ</h1>
        <p class="subtitle">Deviens un grand mage des math√©matiques</p>

        <div id="difficulty-selection" class="difficulty-selection">
            <div class="name-form">
                <label for="player-name">‚ú® Entre ton nom de sorcier :</label>
                <input type="text" id="player-name" placeholder="Ton nom" maxlength="20">
            </div>

                        <div class="highscores-container">
                                <h2>üèÜ Hall des Grands Mages üèÜ</h2>
                                <div class="hs-card">
                                    <h3>Facile</h3>
                                    <ul id="highscore-facile" class="highscore-list"></ul>
                                </div>
                                <div class="hs-card">
                                    <h3>Moyen</h3>
                                    <ul id="highscore-moyen" class="highscore-list"></ul>
                                </div>
                                <div class="hs-card">
                                    <h3>Difficile</h3>
                                    <ul id="highscore-difficile" class="highscore-list"></ul>
                                </div>
                                <div class="hs-card">
                                    <h3>Super-Multi</h3>
                                    <ul id="highscore-super-multi" class="highscore-list"></ul>
                                </div>
                        </div>

            <p class="game-mode-subtitle">Choisis ton niveau de sortil√®ge</p>
            <div class="difficulty-buttons">
                <button class="difficulty-btn" onclick="startGame('facile')">üåü Apprenti (30s)</button>
                <button class="difficulty-btn" onclick="startGame('moyen')">üîÆ Confirm√© (10s)</button>
                <button class="difficulty-btn" onclick="startGame('difficile')">‚ö° Grand (5s)</button>
                <button class="difficulty-btn" onclick="startGame('super-multi')">üí´ Super-Multi</button>
            </div>
        </div>

        <div id="game-area" class="game-area hidden">
            <div class="progress" id="progress">Question 1 / 20</div>
            <div class="current-score hidden" id="current-score">Score: 0 pts</div>
            <div class="timer" id="timer">30</div>
            <div class="question" id="question">5 √ó 7 = ?</div>
            <div class="feedback" id="feedback"></div>
            <input type="number" id="answer-input" placeholder="?" autofocus>
            <br>
            <button class="submit-btn" onclick="checkAnswer()">ü™Ñ Lancer le sort !</button>
        </div>

        <div id="results" class="results hidden">
            <div class="emoji" id="result-emoji">üéâ</div>
            <div class="result-message" id="result-message">F√©licitations !</div>
            <div class="score" id="score">18 / 20</div>
            <div class="result-details" id="result-details"></div>
            <div id="new-highscore-message" class="new-highscore hidden">üéä NOUVEAU RECORD ! üéä</div>
            <button class="submit-btn" onclick="resetGame()">üîÑ Nouvelle partie</button>
        </div>
    </div>

    <script src="shared.js"></script>
    <script>
        // On r√©utilise la logique compl√®te adapt√©e de l'ancienne page
        let currentQuestion = 0;
        let correctAnswers = 0;
        let totalQuestions = 20;
        let timeLimit = 30;
        let timeRemaining = 30;
        let timerInterval;
        let num1, num2, correctAnswer;
        let difficulty;
        let playerName = '';
        let totalTimeSpent = 0;
        let totalScore = 0;
        let currentQuestionStartTime;

        window.addEventListener('DOMContentLoaded', function() {
            loadPlayerName('player-name');
            loadHighscoresToElement('facile', document.getElementById('highscore-facile'));
            loadHighscoresToElement('moyen', document.getElementById('highscore-moyen'));
            loadHighscoresToElement('difficile', document.getElementById('highscore-difficile'));
            loadHighscoresToElement('super-multi', document.getElementById('highscore-super-multi'));
        });

        function startGame(level){
            playerName = document.getElementById('player-name').value.trim();
            if(playerName === ''){ alert('‚ö†Ô∏è Entre ton nom de sorcier pour commencer !'); document.getElementById('player-name').focus(); return; }
            savePlayerName(playerName);
            difficulty = level;
            switch(level){case 'facile': timeLimit=30; break; case 'moyen': timeLimit=10; break; case 'difficile': timeLimit=5; break; case 'super-multi': timeLimit=30; break;}
            currentQuestion=0; correctAnswers=0; totalTimeSpent=0; totalScore=0; gameStartTime=Date.now();
            if(difficulty==='super-multi'){ document.getElementById('current-score').classList.remove('hidden'); document.getElementById('current-score').textContent='Score: 0 pts'; } else { document.getElementById('current-score').classList.add('hidden'); }
            document.getElementById('difficulty-selection').classList.add('hidden');
            document.getElementById('game-area').classList.remove('hidden');
            nextQuestion();
        }

        function nextQuestion(){
            currentQuestion++;
            if(currentQuestion>totalQuestions){ showResults(); return; }
            num1 = Math.floor(Math.random()*8)+2;
            num2 = Math.floor(Math.random()*8)+2;
            correctAnswer = num1 * num2;
            document.getElementById('question').textContent = `${num1} √ó ${num2} = ?`;
            document.getElementById('progress').textContent = `Question ${currentQuestion} / ${totalQuestions}`;
            document.getElementById('answer-input').value=''; document.getElementById('feedback').textContent='';
            timeRemaining = timeLimit; currentQuestionStartTime = Date.now(); document.getElementById('timer').textContent = timeRemaining;
            clearInterval(timerInterval); timerInterval = setInterval(updateTimer,1000);
        }

        function updateTimer(){ timeRemaining--; totalTimeSpent++; document.getElementById('timer').textContent = timeRemaining; if(difficulty==='super-multi'){ const elapsed = timeLimit - timeRemaining; if(elapsed<5){ document.getElementById('timer').classList.add('super-fast'); } else if(elapsed<10){ document.getElementById('timer').classList.add('fast'); } }
            if(timeRemaining<=3) document.getElementById('timer').classList.add('warning');
            if(timeRemaining<=0){ clearInterval(timerInterval); showIncorrect(`Temps √©coul√© ! La r√©ponse √©tait ${correctAnswer}`); setTimeout(nextQuestion,2000); }
        }

        function checkAnswer(){ const input = document.getElementById('answer-input'); const val = input.value.trim(); if(val===''){ input.classList.add('error'); document.getElementById('feedback').textContent='‚ö†Ô∏è Tu dois entrer une r√©ponse !'; setTimeout(()=>input.classList.remove('error'),500); return; } const userNum = parseInt(val); if(isNaN(userNum)){ input.classList.add('error'); document.getElementById('feedback').textContent='‚ö†Ô∏è Entre un nombre valide !'; setTimeout(()=>input.classList.remove('error'),500); return; } clearInterval(timerInterval); const responseTime = (Date.now() - currentQuestionStartTime)/1000; if(userNum === correctAnswer){ correctAnswers++; if(difficulty==='super-multi'){ let points=0; if(responseTime<5) points=7; else if(responseTime<10) points=3; else points=1; totalScore+=points; showCorrect(points); document.getElementById('current-score').textContent=`Score: ${totalScore} pts`; } else { showCorrect(); } } else { showIncorrect(`Non, c'√©tait ${correctAnswer}`); } setTimeout(nextQuestion,2000); }

        function showCorrect(points=null){ const messages=['‚ú® Excellent sortil√®ge !','üåü Parfait !','ü™Ñ Magique !','‚ö° Bravo champion !','üéØ En plein dans le mille !','üèÜ Superbe !','üîÆ Formidable !']; const randomMessage = messages[Math.floor(Math.random()*messages.length)]; if(points!==null){ document.getElementById('feedback').innerHTML = `<div class="correct">${randomMessage}</div><div class="points-earned">+${points} points !</div>`; } else { document.getElementById('feedback').textContent = randomMessage; document.getElementById('feedback').className = 'feedback correct'; } }

        function showIncorrect(message){ document.getElementById('feedback').textContent = message; document.getElementById('feedback').className = 'feedback incorrect'; }

        function showResults(){ clearInterval(timerInterval); document.getElementById('game-area').classList.add('hidden'); document.getElementById('results').classList.remove('hidden'); let scoreValue; if(difficulty==='super-multi'){ scoreValue = totalScore; document.getElementById('score').textContent = `${totalScore} points`; document.getElementById('result-details').innerHTML = `‚úÖ Bonnes r√©ponses : ${correctAnswers}/20<br>‚è±Ô∏è Temps total : ${formatTime(totalTimeSpent)}`; } else { scoreValue = correctAnswers; document.getElementById('score').textContent = `${correctAnswers} / ${totalQuestions}`; document.getElementById('result-details').textContent = `‚è±Ô∏è Temps total : ${formatTime(totalTimeSpent)}`; }
            const isNew = saveHighscore(playerName, scoreValue, totalTimeSpent, difficulty);
            if(isNew) document.getElementById('new-highscore-message').classList.remove('hidden'); else document.getElementById('new-highscore-message').classList.add('hidden');
            loadHighscoresToElement('facile', document.getElementById('highscore-facile'));
            loadHighscoresToElement('moyen', document.getElementById('highscore-moyen'));
            loadHighscoresToElement('difficile', document.getElementById('highscore-difficile'));
            loadHighscoresToElement('super-multi', document.getElementById('highscore-super-multi'));
        }

        function resetGame(){ document.getElementById('results').classList.add('hidden'); document.getElementById('difficulty-selection').classList.remove('hidden'); }

        document.addEventListener('DOMContentLoaded', function(){ document.getElementById('answer-input').addEventListener('keypress', function(e){ if(e.key==='Enter') checkAnswer(); }); document.getElementById('player-name').addEventListener('keypress', function(e){ if(e.key==='Enter') document.querySelector('.difficulty-btn').focus(); }); });
    </script>
</body>
</html>
